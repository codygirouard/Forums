{"ast":null,"code":"import _toConsumableArray from\"C:/Users/cag0398/Desktop/forumsGit/Forums/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/Users/cag0398/Desktop/forumsGit/Forums/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from'react';import{Link,useNavigate}from'react-router-dom';import Header from'./header';import{dateToString}from'./postDate';import{LikeButton}from'./like';import Alert from'./alert';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var NewPostButton=function NewPostButton(){var nav=useNavigate();var handleClick=function handleClick(){if(localStorage.getItem('name')){nav('/newPost');}else{// user not logged in, cannot make new posts\nvar alertModal=document.getElementById('alertModal');var alertText=document.getElementById('alertText');alertText.innerHTML='You need to login to make new posts!';alertModal.style.display='block';}};return/*#__PURE__*/_jsx(\"button\",{className:\"newPostButton\",onClick:handleClick,children:\"+\"});};var Post=function Post(_ref){var id=_ref.id,author=_ref.author,title=_ref.title,commentCount=_ref.commentCount,likes=_ref.likes,usersLiked=_ref.usersLiked,date=_ref.date;var dateString=dateToString(date);return/*#__PURE__*/_jsxs(\"div\",{className:\"post\",children:[/*#__PURE__*/_jsx(LikeButton,{totalLikes:likes,usersLiked:usersLiked,postId:id}),/*#__PURE__*/_jsx(Link,{to:\"post/\".concat(id),className:\"commentLink\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"postContents\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"postTitle\",children:title}),/*#__PURE__*/_jsx(\"h4\",{className:\"postAuthor\",children:\"Posted by \".concat(author,\" \").concat(dateString)}),/*#__PURE__*/_jsx(\"p\",{className:\"postComments\",children:\"\".concat(commentCount,\" comments\")})]})})]});};var Posts=function Posts(_ref2){var pageNum=_ref2.pageNum;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];// load 15 most recent posts on start\nuseEffect(function(){fetch(\"/be/getPosts/\".concat(pageNum)).then(function(response){return response.json();}).then(function(posts){if(!posts.err){setData(function(d){if(d){return[].concat(_toConsumableArray(d),_toConsumableArray(posts));}else{return posts;}});}});},[pageNum]);if(!data){return/*#__PURE__*/_jsx(\"div\",{className:\"loader\"});}else{return data.map(function(_ref3){var _id=_ref3._id,author=_ref3.author,title=_ref3.title,commentCount=_ref3.commentCount,likes=_ref3.likes,usersLiked=_ref3.usersLiked,date=_ref3.date;return/*#__PURE__*/_jsx(Post,{id:_id,author:author,title:title,commentCount:commentCount,likes:likes,usersLiked:usersLiked,date:date},_id);});}};var Page=function Page(){var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),currPage=_useState4[0],setCurrPage=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var timeout=null;var nextPage=function nextPage(){setCurrPage(currPage+1);};var handleScroll=function handleScroll(){if(window.innerHeight+window.pageYOffset>=document.body.offsetHeight-2&&!loading){setLoading(true);nextPage();timeout=setTimeout(function(){setLoading(false);},500);}};useEffect(function(){document.title='Home - Denton Forums';window.addEventListener('scroll',handleScroll);return function(){clearTimeout(timeout);window.removeEventListener('scroll',handleScroll);};});return/*#__PURE__*/_jsx(\"div\",{className:\"posts\",children:/*#__PURE__*/_jsx(Posts,{pageNum:currPage})});};export var Feed=function Feed(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{scroll:true}),/*#__PURE__*/_jsx(Page,{}),/*#__PURE__*/_jsx(NewPostButton,{}),/*#__PURE__*/_jsx(Alert,{})]});};","map":{"version":3,"sources":["C:/Users/cag0398/Desktop/forumsGit/Forums/client/src/Posts.js"],"names":["useEffect","useState","Link","useNavigate","Header","dateToString","LikeButton","Alert","NewPostButton","nav","handleClick","localStorage","getItem","alertModal","document","getElementById","alertText","innerHTML","style","display","Post","id","author","title","commentCount","likes","usersLiked","date","dateString","Posts","pageNum","data","setData","fetch","then","response","json","posts","err","d","map","_id","Page","currPage","setCurrPage","loading","setLoading","timeout","nextPage","handleScroll","window","innerHeight","pageYOffset","body","offsetHeight","setTimeout","addEventListener","clearTimeout","removeEventListener","Feed"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport Header from './header';\r\nimport { dateToString } from './postDate';\r\nimport { LikeButton } from './like';\r\nimport Alert from './alert';\r\n\r\nconst NewPostButton = () => {\r\n  const nav = useNavigate();\r\n  const handleClick = () => {\r\n    if (localStorage.getItem('name')) {\r\n      nav('/newPost');\r\n    } else {\r\n      // user not logged in, cannot make new posts\r\n      const alertModal = document.getElementById('alertModal');\r\n      const alertText = document.getElementById('alertText');\r\n      alertText.innerHTML = 'You need to login to make new posts!';\r\n      alertModal.style.display = 'block';\r\n    }\r\n  };\r\n  return (\r\n    <button className=\"newPostButton\" onClick={handleClick}>\r\n      +\r\n    </button>\r\n  );\r\n};\r\n\r\nconst Post = ({ id, author, title, commentCount, likes, usersLiked, date }) => {\r\n  const dateString = dateToString(date);\r\n\r\n  return (\r\n    <div className=\"post\">\r\n      <LikeButton totalLikes={likes} usersLiked={usersLiked} postId={id} />\r\n      <Link to={`post/${id}`} className=\"commentLink\">\r\n        <div className=\"postContents\">\r\n          <h3 className=\"postTitle\">{title}</h3>\r\n          <h4 className=\"postAuthor\">{`Posted by ${author} ${dateString}`}</h4>\r\n          <p className=\"postComments\">{`${commentCount} comments`}</p>\r\n        </div>\r\n      </Link>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Posts = ({ pageNum }) => {\r\n  const [data, setData] = useState(null);\r\n\r\n  // load 15 most recent posts on start\r\n  useEffect(() => {\r\n    fetch(`/be/getPosts/${pageNum}`)\r\n      .then((response) => response.json())\r\n      .then((posts) => {\r\n        if (!posts.err) {\r\n          setData((d) => {\r\n            if (d) {\r\n              return [...d, ...posts];\r\n            } else {\r\n              return posts;\r\n            }\r\n          });\r\n        }\r\n      });\r\n  }, [pageNum]);\r\n\r\n  if (!data) {\r\n    return <div className=\"loader\"></div>;\r\n  } else {\r\n    return data.map(\r\n      ({ _id, author, title, commentCount, likes, usersLiked, date }) => (\r\n        <Post\r\n          key={_id}\r\n          id={_id}\r\n          author={author}\r\n          title={title}\r\n          commentCount={commentCount}\r\n          likes={likes}\r\n          usersLiked={usersLiked}\r\n          date={date}\r\n        />\r\n      )\r\n    );\r\n  }\r\n};\r\n\r\nconst Page = () => {\r\n  const [currPage, setCurrPage] = useState(1);\r\n  const [loading, setLoading] = useState(false);\r\n  let timeout = null;\r\n\r\n  const nextPage = () => {\r\n    setCurrPage(currPage + 1);\r\n  };\r\n\r\n  const handleScroll = () => {\r\n    if (\r\n      window.innerHeight + window.pageYOffset >=\r\n        document.body.offsetHeight - 2 &&\r\n      !loading\r\n    ) {\r\n      setLoading(true);\r\n      nextPage();\r\n      timeout = setTimeout(() => {\r\n        setLoading(false);\r\n      }, 500);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    document.title = 'Home - Denton Forums';\r\n    window.addEventListener('scroll', handleScroll);\r\n\r\n    return () => {\r\n      clearTimeout(timeout);\r\n      window.removeEventListener('scroll', handleScroll);\r\n    };\r\n  });\r\n\r\n  return (\r\n    <div className=\"posts\">\r\n      <Posts pageNum={currPage} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const Feed = () => {\r\n  return (\r\n    <>\r\n      <Header scroll={true} />\r\n      <Page />\r\n      <NewPostButton />\r\n      <Alert />\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}